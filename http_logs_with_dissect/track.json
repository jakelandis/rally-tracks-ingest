{
  "version": 2,
  "description": "Dissect HTTP server log data",
  "corpora": [
    {
      "name": "http_logs_with_dissect",
      "base-url": "https://s3.amazonaws.com/data.elasticsearch.org/apache_logs/json_lines",
      "documents": [
        {
          "target-index": "logs",
          "source-file": "wc_day55.out.json.bz2",
          "target-type": "_doc",
          "document-count": 35735639,
          "compressed-bytes": 111062349,
          "uncompressed-bytes": 3953129657
        },
        {
          "target-index": "logs",
          "source-file": "wc_day56.out.json.bz2",
          "target-type": "_doc",
          "document-count": 17390841,
          "compressed-bytes": 59181923,
          "uncompressed-bytes": 1926467924
        },
        {
          "target-index": "logs",
          "source-file": "wc_day57.out.json.bz2",
          "target-type": "_doc",
          "document-count": 17224057,
          "compressed-bytes": 58792785,
          "uncompressed-bytes": 1907123446
        }
      ]
    }
  ],
  "operations": [
    {
      "name": "create-dissect-pipeline",
      "operation-type": "put-pipeline",
      "id": "dissect-pipeline",
      "body": {
        "description": "Dissects the logs into it's parts",
        "processors": [
          {
            "dissect": {
              "field": "message",
              "pattern": "%{clientip} %{?ident} %{?auth} [%{@timestamp} %{}] \"%{?verb} %{request} HTTP/%{?httpversion}\" %{status} %{size}"
            }
          }
        ]
      }
    },
    {
      "operation-type": "delete-index",
      "name": "delete-logs-index",
      "index": "logs"
    },
    {
      "operation-type": "create-index",
      "name": "create-logs-index",
      "index": "logs",
      "body": {
        "settings": {
          "index.refresh_interval": -1,
          "index.number_of_shards": 1,
          "index.number_of_replicas": 0
        },
        "mappings": {
          "_doc": {
            "dynamic": "strict",
            "_source": {
              "enabled": false
            },
            "properties": {
              "@timestamp": {
                "type": "object",
                "enabled": false
              },
              "clientip": {
                "type": "object",
                "enabled": false
              },
              "message": {
                "type": "object",
                "enabled": false
              },
              "request": {
                "type": "object",
                "enabled": false
              },
              "status": {
                "type": "object",
                "enabled": false
              },
              "size": {
                "type": "object",
                "enabled": false
              }
            }
          }
        }
      }
    },
    {
      "operation-type": "bulk",
      "name": "perform-indexing",
      "indices": "logs",
      "bulk-size": 5000,
      "ingest-percentage": 100,
      "pipeline": "dissect-pipeline"
    },
    {
      "operation-type": "cluster-health",
      "name": "wait-for-green",
      "index": "logs",
      "request-params": {
        "wait_for_status": "green",
        "wait_for_no_relocating_shards": "true"
      }
    }
  ],
  "challenges": [
    {
      "name": "index",
      "description": "Indexes the whole document.",
      "default": true,
      "schedule": [
        {
          "operation": "create-dissect-pipeline"
        },
        {
          "operation": "delete-logs-index"
        },
        {
          "operation": "create-logs-index"
        },
        {
          "operation": "wait-for-green"
        },
        {
          "operation": "perform-indexing",
          "warmup-time-period": 60,
          "clients": 8
        }
      ]
    }
  ]
}
